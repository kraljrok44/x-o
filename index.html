<!DOCTYPE html>
<html lang="sl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe Firebase</title>
<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background-color: #f0f0f0;
    }
    #game {
        display: grid;
        grid-template-columns: repeat(3, 100px);
        grid-template-rows: repeat(3, 100px);
        gap: 5px;
    }
    .cell {
        background-color: #fff;
        border: 2px solid #333;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 2.5rem;
        cursor: pointer;
    }
    .cell:hover {
        background-color: #e0e0e0;
    }
    #status {
        margin-top: 20px;
        font-size: 1.2rem;
    }
    #resetBtn {
        margin-top: 10px;
        padding: 10px 20px;
        font-size: 1rem;
        cursor: pointer;
    }
</style>
</head>
<body>

<h2>Tic Tac Toe (Firebase Multiplayer)</h2>
<div id="game"></div>
<div id="status">Povezovanje...</div>
<button id="resetBtn">Ponastavi igro</button>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDiedKLK3ERNaMT_u5cLQcplTh9ub67G0c",
    authDomain: "x--o-f01ff.firebaseapp.com",
    databaseURL: "https://x--o-f01ff-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "x--o-f01ff",
    storageBucket: "x--o-f01ff.firebasestorage.app",
    messagingSenderId: "1086881785971",
    appId: "1:1086881785971:web:d527d04ae13a14a413e206",
    measurementId: "G-ELM6P84NJL"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const gameRef = db.ref('tic-tac-toe');

  let board = Array(9).fill(null);
  let currentPlayer = 'X';
  let gameOver = false;

  const gameBoard = document.getElementById('game');
  const statusDiv = document.getElementById('status');
  const resetBtn = document.getElementById('resetBtn');

  const winCombos = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  function createBoard() {
    gameBoard.innerHTML = '';
    board.forEach((cell, index) => {
        const cellDiv = document.createElement('div');
        cellDiv.classList.add('cell');
        cellDiv.dataset.index = index;
        cellDiv.innerText = cell || '';
        cellDiv.addEventListener('click', () => handleMove(index));
        gameBoard.appendChild(cellDiv);
    });
  }

  function handleMove(index) {
    if(board[index] || gameOver) return;
    board[index] = currentPlayer;
    updateFirebase();
  }

  function checkWin(player) {
    return winCombos.some(combo => combo.every(i => board[i] === player));
  }

  function updateFirebase() {
    gameRef.set({
      board: board,
      currentPlayer: currentPlayer,
      gameOver: gameOver
    });
  }

  // Listen for changes in Firebase
  gameRef.on('value', snapshot => {
    const data = snapshot.val();
    if(data) {
      board = data.board;
      currentPlayer = data.currentPlayer;
      gameOver = data.gameOver;

      createBoard();

      if(checkWin('X')) statusDiv.innerText = 'Zmagal je: X!';
      else if(checkWin('O')) statusDiv.innerText = 'Zmagal je: O!';
      else if(board.every(cell => cell)) statusDiv.innerText = 'Neodločeno!';
      else statusDiv.innerText = `Na potezi je: ${currentPlayer}`;
    } else {
      statusDiv.innerText = 'Čakamo igralca...';
    }
  });

  resetBtn.addEventListener('click', () => {
    board = Array(9).fill(null);
    currentPlayer = 'X';
    gameOver = false;
    updateFirebase();
  });

  createBoard();
</script>

</body>
</html>
